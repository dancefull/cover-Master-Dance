<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MASTER ANNIVERSARY FRAME</title>
  <link href="https://unpkg.com/cropperjs@1.5.13/dist/cropper.min.css" rel="stylesheet"/>
  <style>
    body { font-family: sans-serif; margin: 16px; background: #111; color: #fff; text-align: center; }
    h1 { font-size: 1.5em; }
    .container { max-width: 600px; margin: auto; }
    canvas { display: none; }
    #frameOverlay { width: 100%; max-width: 100%; pointer-events: none; position: absolute; top: 0; left: 0; }
    #imageWrap { position: relative; display: inline-block; }
    #userImage { max-width: 100%; display: block; }
    .controls { margin-top: 12px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
    button { padding: 10px 20px; font-size: 1em; background: #e600e6; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    input[type="file"] { color: #fff; }
    input[type="range"] { width: 150px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>MASTER ANNIVERSARY FRAME</h1>
    <p>Încarcă poza ta și descarcă rezultatul cu frame-ul aplicat!</p>
    <input type="file" id="upload" accept="image/*"/><br>
    <div class="controls">
      <label>Zoom:</label>
      <input type="range" id="zoom" min="0.1" max="3" step="0.01" value="1">
      <button id="download">Download</button>
    </div>
    <div id="imageWrap">
      <img id="userImage" alt="User" />
      <img id="frameOverlay" src="cover fb master.png" alt="Frame" />
    </div>
  </div>
  <canvas id="resultCanvas"></canvas>

  <script src="https://unpkg.com/cropperjs@1.5.13/dist/cropper.min.js"></script>
  <script>
    const upload = document.getElementById('upload');
    const userImage = document.getElementById('userImage');
    const frameOverlay = document.getElementById('frameOverlay');
    const zoom = document.getElementById('zoom');
    const downloadBtn = document.getElementById('download');
    const canvas = document.getElementById('resultCanvas');
    let cropper;

    upload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (evt) {
        userImage.src = evt.target.result;
      };
      reader.readAsDataURL(file);
    });

    userImage.addEventListener('load', () => {
      if (cropper) cropper.destroy();
      cropper = new Cropper(userImage, {
        viewMode: 1,
        autoCropArea: 1,
        responsive: true,
        background: false,
        movable: true,
        zoomOnWheel: true,
      });
    });

    zoom.addEventListener('input', () => {
      if (cropper) {
        cropper.zoomTo(parseFloat(zoom.value));
      }
    });

    downloadBtn.addEventListener('click', () => {
      if (!cropper) {
        alert("Încarcă o poză mai întâi!");
        return;
      }

      const frameImg = new Image();
      frameImg.src = frameOverlay.src;
      frameImg.onload = () => {
        const width = frameImg.naturalWidth;
        const height = frameImg.naturalHeight;

        const cropped = cropper.getCroppedCanvas({
          width,
          height,
          imageSmoothingQuality: 'high'
        });

        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(cropped, 0, 0, width, height);
        ctx.drawImage(frameImg, 0, 0, width, height);

        canvas.toBlob((blob) => {
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = 'master-anniversary.png';
          a.click();
          URL.revokeObjectURL(a.href);
        }, 'image/png');
      };
    });
  </script>
</body>
</html>
